<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- 
        [5. ë©”íƒ€ íƒœê·¸ ì„¤ì •] 
        ì¹´ì¹´ì˜¤í†¡, í˜ì´ìŠ¤ë¶ ë“± ê³µìœ  ì‹œ ë³´ì—¬ì§ˆ ë¯¸ë¦¬ë³´ê¸° ì •ë³´ì…ë‹ˆë‹¤.
        ì‹¤ì œ ë°°í¬ ì‹œ content ë‚´ìš©ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
    -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì¹´ë“œê°€ ë„ì°©í–ˆì–´ìš”! ğŸ„">
    <meta property="og:description" content="íŠ¹ë³„í•œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1543589077-47d81606c1bf?q=80&w=1000&auto=format&fit=crop">
    <meta property="og:url" content="https://your-domain.com">

    <title>Merry Christmas!</title>

    <!-- êµ¬ê¸€ í°íŠ¸: Nanum Pen Script (ì†ê¸€ì”¨ ëŠë‚Œ) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap" rel="stylesheet">

    <!-- [2. ë””ìì¸ ì»¨ì…‰ (CSS)] -->
    <style>
        /* ì´ˆê¸°í™” ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 100vh; /* ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•´ JSë¡œ ë³´ì • ê°€ëŠ¥ */
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); /* ë°¤í•˜ëŠ˜ ê·¸ë¼ë°ì´ì…˜ */
            font-family: 'Nanum Pen Script', cursive;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ë¥¼ ìœ„í•œ ìº”ë²„ìŠ¤ (ë°°ê²½) */
        #snow-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* ë°°ê²½ */
            pointer-events: none; /* í´ë¦­ í†µê³¼ */
        }

        /* ë©”ì¸ ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
        .card-container {
            position: relative;
            z-index: 10; /* ëˆˆë³´ë‹¤ ìœ„ì— ë°°ì¹˜ */
            width: 90%;
            max-width: 400px;
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05); /* ìœ ë¦¬ì— ë¹„ì¹œ ë“¯í•œ íš¨ê³¼ */
            backdrop-filter: blur(5px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        /* ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        h1, h2, p {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); /* í…ìŠ¤íŠ¸ ë°œê´‘ íš¨ê³¼ */
        }

        .to-text {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #ffecd2;
        }

        .message-text {
            font-size: 1.8rem;
            line-height: 1.4;
            margin: 2rem 0;
            min-height: 80px;
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ í—ˆìš© */
            word-break: keep-all;
        }

        .from-text {
            font-size: 2rem;
            color: #ffecd2;
            margin-top: 1rem;
            text-align: right;
        }

        /* [ì¤‘ì•™ ì˜¤ë¸Œì íŠ¸: CSS í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬] */
        .tree-wrapper {
            position: relative;
            width: 120px;
            height: 160px;
            margin: 0 auto;
            /* íŠ¸ë¦¬ê°€ ë¹›ë‚˜ëŠ” íš¨ê³¼ */
            filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.4)); 
        }

        .star {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: #ffd700;
            animation: twinkle 1.5s infinite alternate;
            z-index: 5;
        }

        .tree-layer {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-style: solid;
        }

        .layer-1 { /* ìƒë‹¨ */
            top: 10px;
            border-width: 0 30px 40px 30px;
            border-color: transparent transparent #2ecc71 transparent;
            z-index: 3;
        }
        .layer-2 { /* ì¤‘ë‹¨ */
            top: 35px;
            border-width: 0 45px 55px 45px;
            border-color: transparent transparent #27ae60 transparent;
            z-index: 2;
        }
        .layer-3 { /* í•˜ë‹¨ */
            top: 70px;
            border-width: 0 60px 70px 60px;
            border-color: transparent transparent #145a32 transparent;
            z-index: 1;
        }

        .trunk { /* ë‚˜ë¬´ ê¸°ë‘¥ */
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 25px;
            background-color: #795548;
            z-index: 0;
        }

        /* ì˜¤ë„ˆë¨¼íŠ¸ (ì¥ì‹ ë³¼) */
        .ornament {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            box-shadow: 0 0 5px #fff;
            animation: blink 2s infinite;
        }
        .o1 { top: 40px; left: -10px; animation-delay: 0s; }
        .o2 { top: 75px; left: 15px; animation-delay: 0.5s; background: #3498db; }
        .o3 { top: 100px; left: -20px; animation-delay: 1s; background: #f1c40f; }

        @keyframes twinkle {
            0% { opacity: 0.5; transform: translateX(-50%) scale(0.8); }
            100% { opacity: 1; transform: translateX(-50%) scale(1.2); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; filter: brightness(1.5); }
            50% { opacity: 0.5; filter: brightness(1); }
        }

        /* [4. ì»¨íŠ¸ë¡¤ ë²„íŠ¼ UI] */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            gap: 15px;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #fff;
            padding: 10px 20px;
            border-radius: 30px;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            backdrop-filter: blur(3px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
        }
        
        .btn:active {
            transform: scale(0.95);
        }

        /* [5. AI ëª¨ë‹¬ ë° ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ (ì¶”ê°€ë¨)] */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.3);
            text-align: left;
            position: relative;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            color: #ffecd2;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 1.2rem;
        }

        .input-group textarea {
            height: 80px;
            resize: none;
        }

        /* AI ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .ai-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            font-weight: bold;
            border: none;
            width: 100%;
            margin-top: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }
        
        .ai-btn.loading {
            opacity: 0.7;
            cursor: wait;
        }

        .action-btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .close-btn {
            background: #e74c3c;
            border: none;
        }

        .apply-btn {
            background: #2ecc71;
            border: none;
            flex-grow: 1;
        }

        /* ìˆ¨ê²¨ì§„ ì˜¤ë””ì˜¤ ìš”ì†Œ */
        audio { display: none; }
    </style>
</head>
<body>

    <!-- ëˆˆ ë‚´ë¦¬ëŠ” ìº”ë²„ìŠ¤ -->
    <canvas id="snow-canvas"></canvas>

    <!-- ì¹´ë“œ ë‚´ìš© -->
    <div class="card-container">
        <!-- ë°›ëŠ” ì‚¬ëŒ -->
        <h1 class="to-text" id="to">To. ì‚¬ë‘í•˜ëŠ” ë„ˆì—ê²Œ</h1>

        <!-- CSS í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬ -->
        <div class="tree-wrapper">
            <div class="star">â˜…</div>
            <div class="tree-layer layer-1">
                <div class="ornament o1"></div>
            </div>
            <div class="tree-layer layer-2">
                 <div class="ornament o2"></div>
            </div>
            <div class="tree-layer layer-3">
                 <div class="ornament o3"></div>
            </div>
            <div class="trunk"></div>
        </div>

        <!-- ë©”ì¸ ë©”ì‹œì§€ -->
        <p class="message-text" id="msg">
            ì¦ê²ê³  í–‰ë³µí•œ<br>í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë³´ë‚´! ğŸ„
        </p>

        <!-- ë³´ë‚´ëŠ” ì‚¬ëŒ -->
        <p class="from-text" id="from">From. ì‚°íƒ€ê°€</p>
    </div>

    <!-- [í¸ì§‘ ëª¨ë‹¬ ì°½ ì¶”ê°€] -->
    <div class="modal-overlay" id="edit-modal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 1rem; color: #fff;">ì¹´ë“œ ë§Œë“¤ê¸° âœï¸</h2>
            
            <div class="input-group">
                <label>ë°›ëŠ” ì‚¬ëŒ</label>
                <input type="text" id="input-to" value="ì‚¬ë‘í•˜ëŠ” ë„ˆì—ê²Œ">
            </div>

            <div class="input-group">
                <label>ë³´ë‚´ëŠ” ì‚¬ëŒ</label>
                <input type="text" id="input-from" value="ì‚°íƒ€ê°€">
            </div>

            <div class="input-group">
                <label>ë©”ì‹œì§€</label>
                <button class="btn ai-btn" id="ai-generate-btn">âœ¨ AI ë§ˆë²•ì‚¬ë¡œ ë©”ì‹œì§€ ìë™ ìƒì„±</button>
                <textarea id="input-msg" placeholder="ì—¬ê¸°ì— ë©”ì‹œì§€ë¥¼ ì ê±°ë‚˜ ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!">ì¦ê²ê³  í–‰ë³µí•œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë³´ë‚´!</textarea>
            </div>

            <div class="action-btn-group">
                <button class="btn close-btn" id="modal-close">ë‹«ê¸°</button>
                <button class="btn apply-btn" id="modal-apply">ì ìš©í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
    <div class="controls">
        <button class="btn" id="edit-btn">âœï¸ ì¹´ë“œ ì“°ê¸°</button>
        <button class="btn" id="bgm-btn">ğŸµ BGM Play</button>
        <button class="btn" id="share-btn">ğŸ”— ë§í¬ ë³µì‚¬</button>
    </div>

    <!-- [4. BGM íŒŒì¼ ì„¤ì •] -->
    <!-- music.mp3 íŒŒì¼ì„ ê°™ì€ í´ë”ì— ë„£ê±°ë‚˜, ì™¸ë¶€ URLì„ srcì— ì…ë ¥í•˜ì„¸ìš” -->
    <!-- ë¬´ë£Œ ìºë¡¤ ì˜ˆì‹œ URLì„ ë„£ì–´ë‘ì—ˆìŠµë‹ˆë‹¤ -->
    <audio id="bgm" loop>
        <source src="Christmas_Homecoming.mp3" type="audio/mpeg">
        ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </audio>

    <!-- [3. ê¸°ëŠ¥ ë¡œì§ (JavaScript)] -->
    <script>
        // í˜„ì¬ ê³µìœ í•  URLì„ ì €ì¥í•˜ëŠ” ì „ì—­ ë³€ìˆ˜ (ì´ˆê¸°ê°’: í˜„ì¬ ì£¼ì†Œ)
        let currentShareUrl = window.location.href;

        /** * 1. URL íŒŒë¼ë¯¸í„° íŒŒì‹± ë° í…ìŠ¤íŠ¸ ì ìš©
         * ì˜ˆ: index.html?to=ì˜í¬&from=ì² ìˆ˜&msg=ë©”ë¦¬í¬ë¦¬ìŠ¤ë§ˆìŠ¤
         */
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            
            // íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
            const toName = params.get('to');
            const fromName = params.get('from');
            const message = params.get('msg');

            // DOM ìš”ì†Œ ì—…ë°ì´íŠ¸
            if (toName) document.getElementById('to').innerText = `To. ${toName}`;
            if (fromName) document.getElementById('from').innerText = `From. ${fromName}`;
            if (message) document.getElementById('msg').innerText = message;

            // ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ ì‹œì‘
            startSnowFall();
        };

        // --- Gemini API ê¸°ëŠ¥ ì¶”ê°€ ---
        const apiKey = ""; // API í‚¤ëŠ” ì‹¤í–‰ í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.

        async function generateChristmasMessage(to, from) {
            const btn = document.getElementById('ai-generate-btn');
            const originalText = btn.innerText;
            
            try {
                btn.innerText = "âœ¨ ì‚°íƒ€ê°€ ë©”ì‹œì§€ë¥¼ ìƒê°ì¤‘...";
                btn.classList.add('loading');

                const prompt = `
                    ì‘ì„±ì: ${from}
                    ìˆ˜ì‹ ì: ${to}
                    
                    ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì¹´ë“œì— ë“¤ì–´ê°ˆ ì•„ì£¼ ê°ë™ì ì´ê³  ë”°ëœ»í•œ ì§§ì€ ë©”ì‹œì§€ë¥¼ í•œêµ­ì–´ë¡œ 2~3ë¬¸ì¥ ì‘ì„±í•´ì¤˜. 
                    ì´ëª¨ì§€ë¥¼ ì ì ˆíˆ ì„ì–´ì„œ ì˜ˆì˜ê³  ì‚¬ë‘ìŠ¤ëŸ½ê²Œ.
                    ê²°ê³¼ë¬¼ì—ëŠ” ë©”ì‹œì§€ ë‚´ìš©ë§Œ ì¶œë ¥í•´ì¤˜.
                `;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');

                const data = await response.json();
                const generatedText = data.candidates[0].content.parts[0].text;

                // í…ìŠ¤íŠ¸ ì˜ì—­ì— ìë™ ì…ë ¥
                document.getElementById('input-msg').value = generatedText;

            } catch (error) {
                console.error("AI ìƒì„± ì‹¤íŒ¨:", error);
                alert("ì‚°íƒ€ì™€ì˜ í†µì‹ ì´ ì›í™œí•˜ì§€ ì•Šì•„ìš” ğŸ˜­ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            } finally {
                btn.innerText = originalText;
                btn.classList.remove('loading');
            }
        }

        // --- ëª¨ë‹¬ ê´€ë ¨ ë¡œì§ ---
        const modal = document.getElementById('edit-modal');
        const editBtn = document.getElementById('edit-btn');
        const closeBtn = document.getElementById('modal-close');
        const applyBtn = document.getElementById('modal-apply');
        const aiBtn = document.getElementById('ai-generate-btn');

        // ëª¨ë‹¬ ì—´ê¸°
        editBtn.addEventListener('click', () => {
            // í˜„ì¬ í™”ë©´ì˜ ê°’ì„ inputì— ì±„ì›Œë„£ê¸°
            document.getElementById('input-to').value = document.getElementById('to').innerText.replace('To. ', '');
            document.getElementById('input-from').value = document.getElementById('from').innerText.replace('From. ', '');
            document.getElementById('input-msg').value = document.getElementById('msg').innerText;
            
            modal.style.display = 'flex';
        });

        // ëª¨ë‹¬ ë‹«ê¸°
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // AI ë©”ì‹œì§€ ìƒì„± ë²„íŠ¼ í´ë¦­
        aiBtn.addEventListener('click', () => {
            const to = document.getElementById('input-to').value || "ì¹œêµ¬";
            const from = document.getElementById('input-from').value || "ë‚˜";
            generateChristmasMessage(to, from);
        });

        // ì ìš©í•˜ê¸° ë²„íŠ¼ í´ë¦­
        applyBtn.addEventListener('click', () => {
            const newTo = document.getElementById('input-to').value;
            const newFrom = document.getElementById('input-from').value;
            const newMsg = document.getElementById('input-msg').value;

            // 1. í™”ë©´ ê°±ì‹ 
            document.getElementById('to').innerText = `To. ${newTo}`;
            document.getElementById('from').innerText = `From. ${newFrom}`;
            document.getElementById('msg').innerText = newMsg;

            // 2. URL ì—…ë°ì´íŠ¸ ë¡œì§ ìˆ˜ì • (SecurityError ë°©ì§€ ë° ë§í¬ ìƒì„±)
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('to', newTo);
            newUrl.searchParams.set('from', newFrom);
            newUrl.searchParams.set('msg', newMsg);
            
            // ê³µìœ í•  URL ë³€ìˆ˜ì— ì €ì¥ (pushState ì‹¤íŒ¨ ì‹œì—ë„ ê³µìœ  ê¸°ëŠ¥ ì‘ë™ ë³´ì¥)
            currentShareUrl = newUrl.toString();

            try {
                // ë¯¸ë¦¬ë³´ê¸° í™˜ê²½ì—ì„œëŠ” ì´ ë¶€ë¶„ì´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ try-catch ì²˜ë¦¬
                window.history.pushState({}, '', newUrl);
            } catch (e) {
                console.warn("ì£¼ì†Œì°½ URL ì—…ë°ì´íŠ¸ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤ (ë¯¸ë¦¬ë³´ê¸° í™˜ê²½). ê³µìœ  ë§í¬ëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.", e);
            }

            modal.style.display = 'none';
        });

        /**
         * 2. Canvas ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ (Snowfall)
         */
        function startSnowFall() {
            const canvas = document.getElementById('snow-canvas');
            const ctx = canvas.getContext('2d');

            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            // ëˆˆì†¡ì´ ì„¤ì •
            const snowflakes = [];
            const maxSnowflakes = 150; // ëˆˆì†¡ì´ ê°œìˆ˜ (ì„±ëŠ¥ì— ë”°ë¼ ì¡°ì ˆ)

            class Snowflake {
                constructor() {
                    this.reset();
                }

                reset() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height * -1; // í™”ë©´ ìœ„ì—ì„œ ì‹œì‘
                    this.size = Math.random() * 3 + 1; // í¬ê¸° 1~4px
                    this.speed = Math.random() * 1 + 0.5; // ì†ë„
                    this.opacity = Math.random() * 0.5 + 0.3; // íˆ¬ëª…ë„
                    this.sway = Math.random() * 0.02 - 0.01; // ì¢Œìš° í”ë“¤ë¦¼
                }

                update() {
                    this.y += this.speed;
                    this.x += Math.sin(this.y * 0.01) + this.sway;

                    // í™”ë©´ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ë‹¤ì‹œ ìœ„ë¡œ ë¦¬ì…‹
                    if (this.y > canvas.height) {
                        this.reset();
                    }
                }

                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                    ctx.fill();
                    ctx.closePath();
                }
            }

            // ì´ˆê¸° ëˆˆì†¡ì´ ìƒì„±
            for (let i = 0; i < maxSnowflakes; i++) {
                const flake = new Snowflake();
                // ì²˜ìŒì— í™”ë©´ ì „ì²´ì— í¼ì ¸ìˆê²Œ ë°°ì¹˜
                flake.y = Math.random() * canvas.height;
                snowflakes.push(flake);
            }

            // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                snowflakes.forEach(flake => {
                    flake.update();
                    flake.draw();
                });
                requestAnimationFrame(animate);
            }
            animate();
        }

        /**
         * 3. BGM ì¬ìƒ ì»¨íŠ¸ë¡¤
         */
        const bgmBtn = document.getElementById('bgm-btn');
        const audio = document.getElementById('bgm');
        let isPlaying = false;

        bgmBtn.addEventListener('click', () => {
            if (isPlaying) {
                audio.pause();
                bgmBtn.innerText = "ğŸµ BGM Play";
                bgmBtn.style.background = "rgba(255, 255, 255, 0.2)";
            } else {
                audio.play().then(() => {
                    bgmBtn.innerText = "â¸ BGM Pause";
                    bgmBtn.style.background = "rgba(255, 215, 0, 0.4)"; // ì¬ìƒ ì¤‘ì¼ ë•Œ ê¸ˆë¹›
                }).catch(e => {
                    alert("ë¸Œë¼ìš°ì € ì •ì±…ìœ¼ë¡œ ì¸í•´ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    console.error(e);
                });
            }
            isPlaying = !isPlaying;
        });

        /**
         * 4. ë§í¬ ê³µìœ  ê¸°ëŠ¥ (í´ë¦½ë³´ë“œ ë³µì‚¬)
         * ìˆ˜ì •: window.location.href ëŒ€ì‹  currentShareUrl ì‚¬ìš©
         */
        const shareBtn = document.getElementById('share-btn');
        shareBtn.addEventListener('click', () => {
            // ì£¼ì†Œì°½ ì—…ë°ì´íŠ¸ê°€ ì‹¤íŒ¨í–ˆë”ë¼ë„ ì €ì¥ëœ URL ì‚¬ìš©
            const shareUrl = currentShareUrl;
            
            // Clipboard API ì‚¬ìš©
            navigator.clipboard.writeText(shareUrl).then(() => {
                const originalText = shareBtn.innerText;
                shareBtn.innerText = "âœ… ë³µì‚¬ ì™„ë£Œ!";
                setTimeout(() => {
                    shareBtn.innerText = originalText;
                }, 2000);
            }).catch(err => {
                prompt("ì´ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ì „ë‹¬í•˜ì„¸ìš”:", shareUrl);
            });
        });

    </script>
</body>
</html>